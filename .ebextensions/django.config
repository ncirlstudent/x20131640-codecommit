packages: 
 yum:
  sqlite-devel: []

files:
  "/etc/httpd/conf.d/update.conf":
    mode: "000644"
    owner: root
    group: root
    encoding: plain
    content: |
       LoadModule rewrite_module modules/mod_rewrite.so
       LoadModule proxy_module modules/mod_proxy.so
       LoadModule proxy_http_module modules/mod_proxy_http.so
       LoadModule mpm_event_module modules/mod_mpm_event.so
       <VirtualHost *:80>
         ProxyRequests Off
         ProxyPass / http://localhost:8000/
         ProxyPassReverse / http://localhost:8000/
       </VirtualHost>

container_commands:
  01_restart:
    command: "service httpd restart"
  02_migrate:
    command: "source /var/app/venv/*/bin/activate &&  python manage.py migrate"
    leader_only: true
  03_start:
    command: "source /var/app/venv/*/bin/activate && gunicorn eshop.wsgi:application -b 0.0.0.0:8000"
option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "eshop.settings"
    PYTHONPATH: "/var/app/current:$PYTHONPATH"

